---
output: github_document
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# `patter.workflows`
**Iterative animal-tracking workflows**

[![Project Status: Active â€“ The project has reached a stable, usable state and is being actively developed.](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active)
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![CRAN status](https://www.r-pkg.org/badges/version/patter)](https://CRAN.R-project.org/package=patter)

`patter.workflows` provides iterative workflows for animal-tracking analyses, with a focus on the [`patter`](https://github.com/edwardlavender/patter) package. The core routines provide an iterative framework for repeated applications of algorithms that estimate the positions of tagged individuals (coordinates) or patterns of space use. This facilitates analyses of multiple individuals, time blocks and algorithm sensitivity (i.e., multiple parameters). Routines handle the iteration, parallelisation and errors, and record both algorithm outputs and call statistics (such as computation time). Outputs can be saved in memory or written to disk, depending on memory requirements. These routines were motivated by the iterative analyses in Lavender et al. (2024) and (2025). 

> **Note:**
> `patter.workflows` is a new `R` package. Like all new packages, you should use it with a degree of caution. Please share feedback and issues.

# Installation

1. **Install [`patter`](https://github.com/edwardlavender/patter)** and its dependencies by following the instructions [here](https://github.com/edwardlavender/patter).

2. **Install `patter.workflows`** with:

``` r
install.packages(c("devtools", "rmarkdown"))
devtools::install_github("edwardlavender/patter", 
                         dependencies = TRUE, 
                         build_vignettes = rmarkdown::pandoc_available())
```

# Functionality 
    
## Coordinate estimation 

**`lapply_estimate_coord()`** is a core function that iteratively estimates coordinates using selected algorithms. To implement this function, provide an `algorithm_*()` function and a `constructor_*()` function that constructs a named list of arguments for `algorithm_*()`. 

The following `algorithm` functions are provided:

  * Use `algorithm_coa()` to implement the COA algorithm. This wraps `patter::coa()`;
  * Use `algorithm_rsp()` to implement the RSP algorithm. This wraps `RSP::runRSP()`;
  * Use `algorithm_particle()` to implement a particle algorithm. This wraps `patter::pf_filter()` and `pf_smoother_two_filter()`;

These functions are supported by in-built `constructor_*()` functions:

  * For `algorithm_coa()`, use `constructor_coa()`;
  * For `algorithm_rsp()`, use `constructor_rsp()`;
  * For `algorithm_particle()`, a custom `constructor_*()` function is required;

For custom `constructor_*()` functions, ancillary helpers are available:

  * See `get_input` functions (e.g., `get_dataset_detections()`) to get algorithm inputs;

Interoperability between `patter.workflow` structures and `trackyverse` packages is provided by `as_*()` functions:

  * `as_actel()` converts [`patter`](https://github.com/edwardlavender/patter) detection datasets to [`actel`](https://github.com/hugomflavio/actel) format;
  * `as_glatos()` converts [`patter`](https://github.com/edwardlavender/patter) detection datasets to [`glatos`](https://github.com/ocean-tracking-network/glatos) format;
    
## UD estimation 
    
TO DO
    
* `lapply_estimate_ud_*()` functions to estimate utilisation distributions:
    * `lapply_estimate_ud_pou()`
    * `lapply_estimate_ud_spatstat()`
    * `lapply_estimate_ud_dbbmm()` 
    
## Visualisation 
    
`patter.workflow` makes  additional routines for plotting available.
    
`lapply_qplot_*()` functions are 'quick' plotting routines:

* Use `lapply_qplot_coord()` to plot estimates coordinates for multiple units (e.g., individuals);
* Use `lapply_qplot_ud()` to plot estimated utilisation distributions for multiple units;
    
`gg*()` functions provide more sophisticated `ggplot2` wrappers:

* Use `ggmaps()` to map patterns of space use for multiple units;
    
## Spatial operations

`patter.workflow` also makes a series of spatial helpers available for custom workflows. 

For reading/writing spatial vector data with [`terra`](https://github.com/rspatial/terra) via [`qs`](https://github.com/qsbase/qs), see `q*()` functions:

  * Use `qreadvect()`/`qsavevect()` to read/write `SpatVector`s;
  * Use `qreadext()`/`qsaveext()` to read/write `SpatExtent`s
    
For [`terra`](https://github.com/rspatial/terra) `SpatRaster` routines, see `map_*()` functions:

  * Use `map_ram()` to read a `SpatRaster` into memory;
  * Use `map_normalise()` to normalise a `SpatRaster`;
  * Use `map_bbox()` to get the boundary box;
        
To compute distances, see `dist_*()` functions:

  * Use `dist_along_path()` to compute distances along a trajectory;

## Project management 

`dir_*()` helpers support project management:

  * Use `dirs.create()` to create directories;
  * Use `dirs.copy()` copy directories and their contents;

# Examples

For package examples, see `?patter.workflows`. 

# Citation 

To cite `patter.workflows` in publications, please use:

* Lavender, E. et al. (2024). Particle algorithms for animal movement modelling in receiver arrays. bioRxiv. https://doi.org/10.1101/2024.09.16.613223. 
* Lavender, E. et al. (2024). `patter`: particle algorithms for animal tracking in `R` and `Julia`. bioRxiv. https://doi.org/10.1101/2024.07.30.605733
* Lavender, E. et al. (2025). Animal tracking with particle algorithms for conservation. bioRxiv. https://doi.org/10.1101/2025.02.13.638042

## Code of Conduct

Please note that the patter.workflows project is released with a [Contributor Code of Conduct](https://contributor-covenant.org/version/2/1/CODE_OF_CONDUCT.html). By contributing to this project, you agree to abide by its terms.
